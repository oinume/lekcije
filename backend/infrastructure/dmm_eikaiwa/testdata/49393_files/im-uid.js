!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.IMUID=e():t.IMUID=e()}(this,(function(){return function(){var t={996:function(t,e){!function(){"use strict";var t={};!function(){var e=t;Object.defineProperty(e,"__esModule",{value:!0}),e.imUlid=void 0;var o="0123456789ABCDEFGHJKMNPQRSTVWXYZ";e.imUlid=function(){for(var t,e=Date.now(),i="",n=10;n--;)i=o[t=e%32]+i,e=(e-t)/32;n=16;var r=new Uint8Array(n);("crypto"in window?crypto:msCrypto).getRandomValues(r);for(;n--;)i+=o[31&r[n]];return i}}();var o=e;for(var i in t)o[i]=t[i];t.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})}()}},e={};function o(i){var n=e[i];if(n!==undefined)return n.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,o),r.exports}o.d=function(t,e){for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};var i={};return function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}o.d(i,{IMUID:function(){return O}});var u=o(996);function a(t){for(var e=t+"=",o=e.length,i=document.cookie.split("; "),n=0,r=i.length,u=void 0;n<r;n++)if((u=i[n]).substr(0,o)===e)return u.slice(o);return null}function c(t,e,o){void 0===o&&(o={});var i=o.path,n=o.domain,r=o.maxAge,u=o.expires,a=o.secure,c=o.sameSite,s=t+"="+e;i&&(s+=";path="+i),n&&(s+=";domain="+n),"number"==typeof r&&(s+=";max-age="+r),u&&(s+=";expires="+u.toUTCString()),a&&(s+=";secure"),c&&(s+=";samesite="+c),document.cookie=s}function s(t){return localStorage?localStorage.getItem(t):null}function d(t,e){try{localStorage.setItem(t,e)}catch(o){console.error(o)}}function p(t){localStorage&&localStorage.removeItem(t)}function f(t,e,o){return void 0===o&&(o={}),function(t,e,o){void 0===o&&(o={});var i=o.onError,n=o.onTimeout,r=o.timeout,u=o.withCredentials,a=new XMLHttpRequest;return a.onload=function(){e(a.responseText)},i&&(a.onerror=function(){i()}),n&&(a.ontimeout=function(){n()}),a.withCredentials=!!u,a.open("GET",t,!0),"number"==typeof r&&(a.timeout=r),a.send(),a}(t,(function(t){e(JSON.parse(t))}),o)}var l="ready",v="loading",m="done",h="expired",y="loadingInBackground",b="none",I="lax",k="optout",x="https",g="timeout",w="_im_vid",S="_im_uid_expire",M="_im_uid_status",U="_im_uid",D=function(t){var e="."+location.hostname,o=location.protocol===x;!function(t,e){void 0===e&&(e={}),c(t,"",{maxAge:0,path:e.path,domain:e.domain,secure:e.secure,sameSite:e.sameSite})}(t,{domain:e,path:"/",secure:o,sameSite:o?b:I})},T=function(){function e(){t(this,e),r(this,"processorMap",{})}return n(e,[{key:"run",value:function(t){"customerId"in t&&"callback"in t?this.processIMUIDRequest(t):"optout"in t&&this.processOptoutRequest(t)}},{key:"processIMUIDRequest",value:function(t){var e=t.customerId;e in this.processorMap||(this.processorMap[e]=new _({cid:e})),this.processorMap[e].processIMUIDRequest(t)}},{key:"processOptoutRequest",value:function(t){t.optout?e.vid=k:e.vid===k&&e.reacreateVid()}},{key:"get",value:function(t){var e;return(null===(e=this.processorMap[t])||void 0===e?void 0:e.uid)||""}}],[{key:"vid",get:function(){var t=a(w);return t||(t=(0,u.imUlid)(),e.vid=t),t},set:function(t){t?function(t,e){var o,i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},n="."+location.hostname,r=location.protocol===x,u=i.extendExpireSeconds;u&&(o=new Date).setTime(o.getTime()+1e3*u),c(t,e,{domain:n,path:"/",secure:r,sameSite:r?b:I,expires:o})}(w,t,{extendExpireSeconds:2592e3}):D(w)}},{key:"reacreateVid",value:function(){e.vid=null;var t=e.vid;e.vid=t}},{key:"extendExpireToVid",value:function(){var t=e.vid;e.vid=t}}]),e}(),_=function(){function e(o){t(this,e),r(this,"cid",void 0),this.cid=o.cid}return n(e,[{key:"uidExpireTime",get:function(){var t=this.cid,e=s("".concat(S,".").concat(t));return"string"==typeof e?parseInt(e||"0"):null},set:function(t){var e=this.cid,o="".concat(S,".").concat(e);"number"==typeof t?d(o,t+""):p(o)}},{key:"uidLoadStatus",get:function(){var t=this.cid,e=s("".concat(M,".").concat(t));return null===e?l:e},set:function(t){var e=this.cid;d("".concat(M,".").concat(e),t)}},{key:"uid",get:function(){var t=this.cid;return s("".concat(U,".").concat(t))},set:function(t){var e=this.cid,o="".concat(U,".").concat(e);t?d(o,t):p(o)}},{key:"processIMUIDRequest",value:function(t,e){var o=this;e||(e=Date.now());var i=t.callbackTimeout,n=void 0===i?1e3:i,r=t.callback,u=t.loopbacks;T.extendExpireToVid();var a=T.vid,c=a===k;if(c)r({uid:"",vid:"",optouted:c,status:m,loopbacks:u});else{var s=this.uidExpireTime,d=this.cid,p=this.uid,b=this.uidLoadStatus,I=Date.now();p&&"number"==typeof s&&I>=s&&(b=h);var x=t.SYNC_URL||"https://audiencedata.im-apps.net/imuid/get";switch(x+="?cid="+d+"&vid="+a,b){default:case l:this.uidLoadStatus=v,this.uidExpireTime=I+18e5,f(x,(function(t){var e=t.uid;o.uid=e,o.uidLoadStatus=m,r({uid:e,vid:a,optouted:!1,status:m,loopbacks:u})}),{withCredentials:!0,timeout:n,onTimeout:function(){o.uidLoadStatus=l,r({uid:"",vid:"",optouted:!1,status:g,loopbacks:u})}});break;case v:if(I>=e+n)return this.uidLoadStatus=l,void r({uid:"",vid:"",optouted:!1,status:g,loopbacks:u});setTimeout((function(){o.processIMUIDRequest(t,e)}),9);break;case m:r({uid:this.uid||"",vid:a,optouted:c,status:m,loopbacks:u});break;case h:this.uidLoadStatus=y,this.uidExpireTime=I+18e5,f(x,(function(t){var e=t.uid;o.uid=e,o.uidLoadStatus=m}),{withCredentials:!0}),r({uid:this.uid||"",vid:a,optouted:!1,status:m,loopbacks:u});break;case y:r({uid:this.uid||"",vid:a,optouted:!1,status:m,loopbacks:u})}}}}]),e}(),E=window.IMUID;E||(E=new T);var R=window.IMUIDRequest;(R instanceof Array||!R)&&(window.IMUIDRequest={push:function(t){E.run(t)}}),R instanceof Array&&R.forEach((function(t){E.run(t)}));var O=E}(),i=i.IMUID}()}));